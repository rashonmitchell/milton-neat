{% comment %} https://codepen.io/rashon/pen/mdgrxyg {% endcomment %}

{% comment %} https://www.walmart.com/ip/Athletic-Works-24oz-Aqua-Protein-Drink-Shaker-Bottle-W-Mixing-Ball/644415102?athbdg=L1102 {% endcomment %}

{% comment %} https://github.com/googlemaps-samples/codelab-locator-maps-js {% endcomment %}

{%- assign pick_up_availabilities = product_variant.store_availabilities | where: 'pick_up_enabled', true -%}

{%- if pick_up_availabilities.size > 0 -%}
	{%- assign closest_location = pick_up_availabilities.first -%}
	<div class="store-locator-info">
		<span class="store-locator-icon">
			{%- liquid
				if closest_location.available
					render 'icon', code: 'success'
				else
					render 'icon', code: 'error'
				endif
			-%}
		</span>

		<div class="store-locator-info-inner">
			{%- if closest_location.available -%}
				<p class="store-locator-info-title">
					{{- 'products.product.pickup_availability.pick_up_available_at_html' | t: location_name: closest_location.location.name -}}
				</p>

				<p class="store-locator-availability-stock">
					{{- closest_location.pick_up_time -}}
				</p>

				<button class="toggle-modal" aria-haspopup="dialog">
					{%- liquid
						if pick_up_availabilities.size == 1
							echo 'products.product.pickup_availability.view_store_info' | t
						else
							echo 'products.product.pickup_availability.check_other_stores' | t
						endif
					-%}
				</button>
			{%- else -%}
				<p class="store-locator-info-title">
					{{ 'products.product.pickup_availability.pick_up_unavailable_at_html' | t: location_name: closest_location.location.name }}
				</p>

				{%- if pick_up_availabilities.size > 1 -%}
					<button class="toggle-modal" aria-haspopup="dialog">
						{{ 'products.product.pickup_availability.check_other_stores' | t }}
					</button>
				{%- endif -%}
			{%- endif -%}
		</div>
	</div>

	<div class="store-locator-modal" role="dialog" aria-modal="true" aria-labelledby="store-locator-modal-product-title">
		<div class="store-locator-header">
			<h2 id="store-locator-modal-product-title" class="store-locator-product-title">{{- product_variant.product.title -}}</h2>

			<p class="store-locator-variant-title">
				{{- product_variant.title -}}
			</p>

			<button class="button secondary-button close-button" aria-label="{{ 'accessibility.close' | t }}">
				{%- render 'icon', code: 'close-thin' -%}
			</button>
		</div>

		<ul class="store-locator-list" role="list">
			{%- for availability in pick_up_availabilities -%}
				<li class="store-locator-item">
					<h3 class="pickup-availability-location">
						{{- availability.location.name -}}
					</h3>

					<div class="store-locator-stock">
						{%- liquid
							if availability.available
								render 'icon', code: 'success'
								echo 'products.product.pickup_availability.pick_up_available' | t
								echo availability.pick_up_time | prepend: ' ' | downcase
							endif
						-%}
					</div>

					{%- assign address = availability.location.address -%}

					<address class="store-locator-address">
						{{- address | format_address -}}
					</address>

					{%- if address.phone.size > 0 -%}
						<p>{{- address.phone -}}</p>
					{%- endif -%}
				</li>
			{%- endfor -%}
		</ul>
	</div>
{%- endif -%}
